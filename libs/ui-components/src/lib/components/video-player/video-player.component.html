<div 
  class="video-container" 
  #videoContainer
  (click)="onContainerClick($event)"
>
  <video
    #videoElement
    [src]="src"
    [poster]="poster"
    [muted]="muted"
    [autoplay]="autoplay"
    [loop]="loop"
    class="video-element"
    preload="auto"
  >
    <ng-container *ngFor="let caption of captions">
      <track 
        [src]="caption.src" 
        [srclang]="caption.srclang" 
        [label]="caption.label" 
        [attr.default]="caption.default ? '' : null"
        kind="subtitles"
      >
    </ng-container>
    Your browser does not support the video tag.
  </video>

  <div class="video-overlay">
    <div class="title-bar" *ngIf="title">{{ title }}</div>

    <!-- Center Controls - Only Play/Pause -->
    <div class="center-controls">
      <!-- Play/Pause -->
      <button 
        type="button"
        class="control-button play-pause" 
        (click)="togglePlayPause(); $event.stopPropagation();" 
      >
        <svg *ngIf="!isPlaying" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polygon points="10 8 16 12 10 16 10 8" fill="white"></polygon>
        </svg>
        <svg *ngIf="isPlaying" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="10" y1="8" x2="10" y2="16" stroke="white"></line>
          <line x1="14" y1="8" x2="14" y2="16" stroke="white"></line>
        </svg>
      </button>
    </div>

    <!-- Bottom Controls -->
    <div class="bottom-controls">
      <!-- Progress Bar -->
      <div class="progress-container">
        <div 
          #progressBar
          class="progress-bar" 
          (click)="seekTo($event); $event.stopPropagation();"
        >
          <div class="progress-background"></div>
          <div class="progress-filled" [style.width.%]="progress"></div>
          <div class="progress-handle" [style.left.%]="progress"></div>
        </div>
        <div class="time-display">
          <span>{{ formatTime(currentTime) }}</span>
          <span>/</span>
          <span>{{ formatTime(duration) }}</span>
        </div>
      </div>

      <!-- Volume and Fullscreen -->
      <div class="controls-row">
        <div class="left-controls">
          <!-- Play/Pause -->
          <button 
            type="button"
            class="control-button" 
            (click)="togglePlayPause(); $event.stopPropagation();" 
            [title]="isPlaying ? 'Pause' : 'Play'"
          >
            <svg *ngIf="!isPlaying" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <svg *ngIf="isPlaying" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="6" y="4" width="4" height="16"></rect>
              <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
          </button>
          
          <!-- Skip Backward -->
          <button 
            type="button"
            class="control-button" 
            (click)="skipBackward(); $event.stopPropagation();" 
            title="Skip backward 10s"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 19c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path>
              <path d="M12 15l-3-3 3-3"></path>
              <path d="M15 12H9"></path>
            </svg>
          </button>
          
          <!-- Speed control -->
          <div class="playback-speed">
            <div class="speed-button">
              <div class="speed-label" (click)="toggleSpeedMenu($event)">
                {{ playbackRate }}x
              </div>
              <div class="speed-menu" *ngIf="showSpeedMenu">
                <div 
                  *ngFor="let speed of playbackSpeeds" 
                  class="speed-option"
                  [class.active]="playbackRate === speed"
                  (click)="setPlaybackSpeed(speed); $event.stopPropagation()">
                  {{ speed }}x
                </div>
              </div>
            </div>
          </div>
          
          <!-- Skip Forward -->
          <button 
            type="button"
            class="control-button" 
            (click)="skipForward(); $event.stopPropagation();" 
            title="Skip forward 10s"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 19c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path>
              <path d="M12 9l3 3-3 3"></path>
              <path d="M9 12h6"></path>
            </svg>
          </button>
          
          <!-- Volume -->
          <button 
            type="button"
            class="control-button volume" 
            (click)="toggleMute(); $event.stopPropagation();" 
          >
            <svg *ngIf="!isMuted" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
              <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
              <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
            </svg>
            <svg *ngIf="isMuted" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
              <line x1="23" y1="9" x2="17" y2="15"></line>
              <line x1="17" y1="9" x2="23" y2="15"></line>
            </svg>
          </button>

          <div class="volume-slider-container" *ngIf="showVolumeControl">
            <input 
              #volumeSlider
              type="range" 
              class="volume-slider" 
              min="0" 
              max="1" 
              step="0.01" 
              [value]="volume"
              (input)="onVolumeChange($event)"
              (click)="$event.stopPropagation()"
            />
          </div>

        </div>

        <div class="right-controls">
          <div class="fullscreen-wrapper">
            <button 
              *ngIf="showFullscreen" 
              type="button"
              class="control-button fullscreen" 
              (click)="toggleFullscreen(); $event.stopPropagation();" 
            >
              <svg *ngIf="!isFullscreen" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
              </svg>
              <svg *ngIf="isFullscreen" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div class="loading-spinner" *ngIf="buffering">
    <svg viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg">
      <g fill="none" fill-rule="evenodd">
        <g transform="translate(1 1)" stroke-width="2">
          <circle stroke-opacity=".5" cx="18" cy="18" r="18" stroke="#fff"/>
          <path d="M36 18c0-9.94-8.06-18-18-18" stroke="#fff">
            <animateTransform
              attributeName="transform"
              type="rotate"
              from="0 18 18"
              to="360 18 18"
              dur="1s"
              repeatCount="indefinite"/>
          </path>
        </g>
      </g>
    </svg>
  </div>
  
  <!-- Debug Info (visible only during development) -->
  <div class="debug-info" *ngIf="false">
    <div>Is Playing: {{ isPlaying }}</div>
    <div>Current Time: {{ currentTime }}</div>
    <div>Duration: {{ duration }}</div>
    <div>Progress: {{ progress }}</div>
  </div>
</div> 