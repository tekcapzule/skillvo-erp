<div 
  class="video-container" 
  #videoContainer
  (mousemove)="onMouseMove()"
  (mouseenter)="onMouseEnter()"
  (mouseleave)="onMouseLeave()"
>
  <video
    #videoElement
    [src]="src"
    [poster]="poster"
    [muted]="muted"
    [autoplay]="autoplay"
    [loop]="loop"
    (click)="onVideoClick()"
    (loadedmetadata)="handleLoadedMetadata()"
    (timeupdate)="handleTimeUpdate()"
    (ended)="handleEnded()"
    class="video-element"
  >
    <ng-container *ngFor="let caption of captions">
      <track 
        [src]="caption.src" 
        [srclang]="caption.srclang" 
        [label]="caption.label" 
        [attr.default]="caption.default ? '' : null"
        kind="subtitles"
      >
    </ng-container>
    Your browser does not support the video tag.
  </video>

  <div class="video-overlay" [class.hide-controls]="!showControlsUI">
    <div class="title-bar" *ngIf="title">{{ title }}</div>

    <div class="center-controls">
      <button class="control-button skip-back" (click)="skipBackward()" aria-label="Skip backward 10 seconds">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 19c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path>
          <path d="M12 15l-3-3 3-3"></path>
          <path d="M15 12H9"></path>
        </svg>
        <span class="tooltip">-10s</span>
      </button>

      <button class="control-button play-pause" (click)="togglePlayPause()" aria-label="Play or pause">
        <svg *ngIf="!isPlaying" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polygon points="10 8 16 12 10 16 10 8"></polygon>
        </svg>
        <svg *ngIf="isPlaying" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="10" y1="8" x2="10" y2="16"></line>
          <line x1="14" y1="8" x2="14" y2="16"></line>
        </svg>
      </button>

      <button class="control-button skip-forward" (click)="skipForward()" aria-label="Skip forward 10 seconds">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 19c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path>
          <path d="M12 9l3 3-3 3"></path>
          <path d="M9 12h6"></path>
        </svg>
        <span class="tooltip">+10s</span>
      </button>
    </div>

    <div class="bottom-controls">
      <div class="progress-container">
        <div 
          #progressBar
          class="progress-bar" 
          (click)="seekTo($event)"
          (mousedown)="startProgressDrag()"
          (mouseup)="stopProgressDrag()"
          (mouseleave)="stopProgressDrag()"
        >
          <div class="progress-background"></div>
          <div class="progress-filled" [style.width.%]="progress"></div>
          <div class="progress-handle" [style.left.%]="progress"></div>
        </div>
        <div class="time-display">
          <span>{{ formatTime(currentTime) }}</span>
          <span>/</span>
          <span>{{ formatTime(duration) }}</span>
        </div>
      </div>

      <div class="controls-row">
        <div class="left-controls">
          <button class="control-button volume" (click)="toggleMute()" aria-label="Toggle mute">
            <svg *ngIf="volume > 0.5 && !isMuted" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
              <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
              <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
            </svg>
            <svg *ngIf="volume > 0 && volume <= 0.5 && !isMuted" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
              <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
            <svg *ngIf="volume === 0 || isMuted" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
              <line x1="23" y1="9" x2="17" y2="15"></line>
              <line x1="17" y1="9" x2="23" y2="15"></line>
            </svg>
          </button>

          <div class="volume-slider-container" *ngIf="showVolumeControl">
            <input 
              #volumeSlider
              type="range" 
              class="volume-slider" 
              min="0" 
              max="1" 
              step="0.01" 
              [value]="volume"
              (input)="onVolumeChange($event)"
            />
          </div>
        </div>

        <div class="right-controls">
          <div class="control-dropdown" *ngIf="showPlaybackSpeed">
            <button class="control-button speed" (click)="toggleSpeedMenu()" aria-label="Playback speed">
              <span>{{ selectedSpeed }}x</span>
            </button>
            <div class="dropdown-menu speed-menu" *ngIf="showSpeedMenu">
              <button 
                *ngFor="let speed of speedOptions" 
                class="dropdown-item" 
                [class.active]="selectedSpeed === speed"
                (click)="setPlaybackSpeed(speed)"
              >
                {{ speed }}x
              </button>
            </div>
          </div>

          <div class="control-dropdown" *ngIf="qualities && qualities.length > 0">
            <button class="control-button quality" (click)="toggleQualityMenu($event)" aria-label="Video quality">
              <span>{{ selectedQuality?.label || 'Auto' }}</span>
            </button>
            <div class="dropdown-menu quality-menu" *ngIf="showQualityMenu">
              <button 
                *ngFor="let quality of qualities" 
                class="dropdown-item"
                [class.active]="selectedQuality?.label === quality.label"
                (click)="closeAllMenus()"
              >
                {{ quality.label }}
              </button>
            </div>
          </div>

          <div class="control-dropdown" *ngIf="captions.length > 0 && showCaptions">
            <button class="control-button captions" (click)="toggleCaptionsMenu()" aria-label="Subtitles">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="7" width="20" height="10" rx="2" ry="2"></rect>
                <line x1="6" y1="11" x2="10" y2="11"></line>
                <line x1="12" y1="11" x2="14" y2="11"></line>
                <line x1="16" y1="11" x2="18" y2="11"></line>
                <line x1="6" y1="15" x2="18" y2="15"></line>
              </svg>
            </button>
            <div class="dropdown-menu captions-menu" *ngIf="showCaptionsMenu">
              <button 
                class="dropdown-item"
                [class.active]="!captionsEnabled"
                (click)="toggleCaptions()"
              >
                Off
              </button>
              <button 
                *ngFor="let caption of captions" 
                class="dropdown-item"
                [class.active]="captionsEnabled"
                (click)="toggleCaptions()"
              >
                {{ caption.label }}
              </button>
            </div>
          </div>

          <button *ngIf="showFullscreen" class="control-button fullscreen" (click)="toggleFullscreen()" aria-label="Toggle fullscreen">
            <svg *ngIf="!isFullscreen" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
            </svg>
            <svg *ngIf="isFullscreen" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div> 