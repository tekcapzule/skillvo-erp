/**
 * File Upload Component - Component-level Styles
 * Version: 2.1.0
 * Last Updated: July 28, 2024
 * 
 * This file defines styles for the File Upload component in the SkillVo design system.
 * It extends the input-control-base class and provides file upload-specific styling.
 */

/* ==========================================================================
   TABLE OF CONTENTS:
   
   1. IMPORTS & VARIABLES
   2. FILE UPLOAD BASE
   3. FILE DROPZONE
   4. FILE LIST & PREVIEW
   5. UPLOAD PROGRESS
   6. STATES & VARIATIONS
   7. ACCESSIBILITY ENHANCEMENTS
   8. RESPONSIVE ADJUSTMENTS
   ========================================================================== */

/* ==========================================================================
   1. IMPORTS & VARIABLES
   ========================================================================== */
@use './../../abstracts' as *;
@use './../../base/utils/mixins/state' as state;
@use './../../base/utils/mixins/layout' as layout;
@use './../../base/utils/mixins/responsive' as responsive;
@use './../../base/utils/mixins/accessibility' as a11y;
@use './../../base/utils/mixins/typography' as typography;

// Component-specific variables
$file-upload-transition-duration: 0.3s;
$file-upload-transition-timing: ease;
$file-upload-min-height: 6rem;
$file-upload-preview-size: 3rem;
$file-upload-icon-size: 1.5rem;
$file-upload-progress-height: 0.5rem;
$file-upload-action-button-size: 2rem;

/* ==========================================================================
   2. FILE UPLOAD BASE
   ========================================================================== */

.sv-file-upload {
  // Extend the input control base styles
  @extend .sv-input-control-base !optional;
  
  // Reset height for file inputs
  height: auto;
  width: 100%;
  padding: 0;
  
  // Add consistent transitions
  transition: border-color $file-upload-transition-duration $file-upload-transition-timing,
              box-shadow $file-upload-transition-duration $file-upload-transition-timing,
              background-color $file-upload-transition-duration $file-upload-transition-timing;
  
  // BEM-style structure
  &__container {
    position: relative;
    width: 100%;
  }
  
  &__input {
    position: absolute;
    width: 0.1px;
    height: 0.1px;
    opacity: 0;
    overflow: hidden;
    z-index: -1;
    
    // Focus styles applied to label instead
    &:focus + .sv-file-upload__label {
      outline: none;
      border-color: var(--sv-primary);
      box-shadow: var(--sv-shadow-focus);
    }
    
    // Disabled state handled by label
    &:disabled + .sv-file-upload__label {
      opacity: 0.6;
      cursor: not-allowed;
      background-color: var(--sv-bg-element-disabled);
      border-color: var(--sv-border-light);
    }
  }
  
  &__label {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: $file-upload-min-height;
    padding: var(--sv-space-5);
    border: 2px dashed var(--sv-border-medium);
    border-radius: var(--sv-radius-md);
    background-color: var(--sv-bg-element);
    cursor: pointer;
    transition: all $file-upload-transition-duration $file-upload-transition-timing;
    
    &:hover {
      border-color: var(--sv-primary);
      background-color: var(--sv-bg-element-hover);
    }
    
    &-icon {
      width: $file-upload-icon-size;
      height: $file-upload-icon-size;
      margin-bottom: var(--sv-space-2);
      color: var(--sv-text-secondary);
    }
    
    &-text {
      font-size: var(--sv-text-sm);
      color: var(--sv-text-secondary);
      text-align: center;
      
      &-primary {
        font-weight: var(--sv-font-medium);
        color: var(--sv-primary);
        margin-bottom: var(--sv-space-1);
      }
      
      &-secondary {
        font-size: var(--sv-text-xs);
        color: var(--sv-text-tertiary);
        margin-top: var(--sv-space-1);
      }
    }
  }
  
  // Size variations
  &--compact {
    .sv-file-upload__label {
      flex-direction: row;
      min-height: var(--sv-size-10);
      padding: var(--sv-space-2) var(--sv-space-3);
      
      &-icon {
        width: var(--sv-icon-size-sm);
        height: var(--sv-icon-size-sm);
        margin-bottom: 0;
        margin-right: var(--sv-space-2);
      }
      
      &-text {
        display: flex;
        align-items: center;
        
        &-primary {
          margin-bottom: 0;
          margin-right: var(--sv-space-2);
        }
        
        &-secondary {
          margin-top: 0;
        }
      }
    }
  }
}

/* ==========================================================================
   3. FILE DROPZONE
   ========================================================================== */

.sv-file-dropzone {
  position: relative;
  
  // Drag-over state
  &.is-drag-over {
    .sv-file-upload__label {
      border-color: var(--sv-primary);
      background-color: rgba(var(--sv-primary-rgb), 0.05);
      box-shadow: var(--sv-shadow-sm);
      transform: scale(1.01);
    }
  }
  
  // Drop indicator
  &__indicator {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(var(--sv-primary-rgb), 0.1);
    border: 2px dashed var(--sv-primary);
    border-radius: var(--sv-radius-md);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 1;
    pointer-events: none;
    opacity: 0;
    transition: opacity $file-upload-transition-duration $file-upload-transition-timing;
    
    &.is-active {
      opacity: 1;
    }
    
    &-icon {
      width: calc($file-upload-icon-size * 1.5);
      height: calc($file-upload-icon-size * 1.5);
      color: var(--sv-primary);
      margin-bottom: var(--sv-space-3);
    }
    
    &-text {
      font-size: var(--sv-text-lg);
      font-weight: var(--sv-font-medium);
      color: var(--sv-primary);
    }
  }
}

/* ==========================================================================
   4. FILE LIST & PREVIEW
   ========================================================================== */

.sv-file-list {
  margin-top: var(--sv-space-3);
  
  &__item {
    display: flex;
    align-items: center;
    padding: var(--sv-space-2);
    border: 1px solid var(--sv-border-light);
    border-radius: var(--sv-radius-md);
    background-color: var(--sv-bg-surface);
    margin-bottom: var(--sv-space-2);
    transition: border-color $file-upload-transition-duration $file-upload-transition-timing,
                background-color $file-upload-transition-duration $file-upload-transition-timing;
    
    &:last-child {
      margin-bottom: 0;
    }
    
    // File preview (image thumbnail or file type icon)
    &-preview {
      width: $file-upload-preview-size;
      height: $file-upload-preview-size;
      margin-right: var(--sv-space-3);
      border-radius: var(--sv-radius-sm);
      overflow: hidden;
      background-color: var(--sv-bg-element);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color $file-upload-transition-duration $file-upload-transition-timing;
      
      &-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      
      &-icon {
        width: var(--sv-icon-size-md);
        height: var(--sv-icon-size-md);
        color: var(--sv-text-secondary);
        transition: color $file-upload-transition-duration $file-upload-transition-timing;
      }
    }
    
    // File details
    &-details {
      flex: 1;
      min-width: 0; // Ensures text truncation works
      
      &-name {
        font-weight: var(--sv-font-medium);
        color: var(--sv-text-primary);
        margin-bottom: var(--sv-space-1);
        @include typography.text-truncate;
      }
      
      &-info {
        display: flex;
        font-size: var(--sv-text-xs);
        color: var(--sv-text-tertiary);
        
        &-size {
          margin-right: var(--sv-space-3);
        }
        
        &-type {
          // Empty for future use
        }
      }
    }
    
    // Action buttons
    &-actions {
      display: flex;
      margin-left: var(--sv-space-2);
      
      &-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: $file-upload-action-button-size;
        height: $file-upload-action-button-size;
        border: none;
        background-color: transparent;
        border-radius: var(--sv-radius-md);
        cursor: pointer;
        color: var(--sv-text-secondary);
        transition: background-color $file-upload-transition-duration $file-upload-transition-timing,
                    color $file-upload-transition-duration $file-upload-transition-timing;
        
        &:hover {
          background-color: var(--sv-bg-element-hover);
          color: var(--sv-text-primary);
        }
        
        &:focus-visible {
          outline: none;
          box-shadow: var(--sv-shadow-focus);
        }
        
        &-icon {
          width: var(--sv-icon-size-sm);
          height: var(--sv-icon-size-sm);
        }
        
        // Button variations with BEM modifiers
        &--remove {
          &:hover {
            background-color: rgba(var(--sv-error-rgb), 0.1);
            color: var(--sv-error);
          }
        }
        
        &--download {
          &:hover {
            color: var(--sv-primary);
          }
        }
      }
    }
  }
  
  // Empty state
  &__empty {
    text-align: center;
    padding: var(--sv-space-4);
    color: var(--sv-text-secondary);
    font-size: var(--sv-text-sm);
  }
}

/* ==========================================================================
   5. UPLOAD PROGRESS
   ========================================================================== */

.sv-file-progress {
  width: 100%;
  margin-top: var(--sv-space-2);
  
  &__bar {
    height: $file-upload-progress-height;
    width: 100%;
    background-color: var(--sv-bg-element);
    border-radius: calc($file-upload-progress-height / 2);
    overflow: hidden;
    
    &-fill {
      height: 100%;
      background-color: var(--sv-primary);
      width: 0;
      border-radius: calc($file-upload-progress-height / 2);
      transition: width $file-upload-transition-duration var(--sv-motion-ease-decelerate);
    }
  }
  
  &__info {
    display: flex;
    justify-content: space-between;
    margin-top: var(--sv-space-1);
    font-size: var(--sv-text-xs);
    color: var(--sv-text-secondary);
    
    &-percent {
      font-weight: var(--sv-font-medium);
    }
    
    &-status {
      text-transform: capitalize;
    }
  }
}

/* ==========================================================================
   6. STATES & VARIATIONS
   ========================================================================== */

// File list item states
.sv-file-list__item {
  // Error state
  &.is-error {
    border-color: var(--sv-error);
    
    .sv-file-list__item-details-name {
      color: var(--sv-error);
    }
    
    .sv-file-list__item-preview {
      background-color: rgba(var(--sv-error-rgb), 0.1);
      
      &-icon {
        color: var(--sv-error);
      }
    }
  }
  
  // Success state
  &.is-success {
    border-color: var(--sv-success);
    
    .sv-file-list__item-preview {
      background-color: rgba(var(--sv-success-rgb), 0.1);
      
      &-icon {
        color: var(--sv-success);
      }
    }
  }
}

// File progress states
.sv-file-progress {
  // Uploading state
  &.is-uploading {
    .sv-file-progress__bar-fill {
      background-color: var(--sv-primary);
    }
  }
  
  // Success state
  &.is-success {
    .sv-file-progress__bar-fill {
      background-color: var(--sv-success);
    }
    
    .sv-file-progress__info-status {
      color: var(--sv-success);
    }
  }
  
  // Error state
  &.is-error {
    .sv-file-progress__bar-fill {
      background-color: var(--sv-error);
    }
    
    .sv-file-progress__info-status {
      color: var(--sv-error);
    }
  }
  
  // Paused state
  &.is-paused {
    .sv-file-progress__bar-fill {
      background-color: var(--sv-warning);
    }
    
    .sv-file-progress__info-status {
      color: var(--sv-warning);
    }
  }
}

// File upload component states
.sv-file-upload {
  // Valid state
  &.is-valid {
    border-color: var(--sv-success);
    
    .sv-file-upload__label {
      border-color: var(--sv-success);
    }
    
    .sv-file-upload__helper-text {
      color: var(--sv-success);
    }
  }
  
  // Invalid state
  &.is-invalid {
    border-color: var(--sv-error);
    
    .sv-file-upload__label {
      border-color: var(--sv-error);
    }
    
    .sv-file-upload__helper-text {
      color: var(--sv-error);
    }
  }
  
  // Disabled state extensions beyond base class handling
  &.is-disabled,
  &:disabled {
    .sv-file-upload__label {
      opacity: 0.6;
      cursor: not-allowed;
      background-color: var(--sv-bg-element-disabled);
      border-color: var(--sv-border-light);
    }
  }
}

/* ==========================================================================
   7. ACCESSIBILITY ENHANCEMENTS
   ========================================================================== */

// Focus management
.sv-file-upload {
  &__input:focus-visible + .sv-file-upload__label {
    @include a11y.focus-ring;
  }
  
  // Screen reader guidance
  &__sr-help {
    @include a11y.visually-hidden;
  }
  
  // High contrast mode support
  @include a11y.high-contrast-mode {
    &__label {
      border: 2px solid currentColor;
    }
    
    &__input:focus-visible + .sv-file-upload__label {
      outline: 2px solid currentColor;
      outline-offset: 2px;
    }
    
    .sv-file-list__item {
      border: 1px solid currentColor;
      
      &.is-error, 
      &.is-success {
        outline: 1px solid currentColor;
        outline-offset: -1px;
      }
    }
    
    .sv-file-progress__bar-fill {
      border: 1px solid currentColor;
    }
  }
}

.sv-file-list__item-actions-btn {
  &:focus-visible {
    @include a11y.focus-ring;
  }
}

/* ==========================================================================
   8. RESPONSIVE ADJUSTMENTS
   ========================================================================== */

@include responsive.breakpoint-down(md) {
  .sv-file-upload {
    &__label {
      min-height: var(--sv-size-20);
      
      &-icon {
        width: calc($file-upload-icon-size * 0.9);
        height: calc($file-upload-icon-size * 0.9);
      }
    }
  }
}

@include responsive.breakpoint-down(sm) {
  .sv-file-upload {
    &__label {
      min-height: var(--sv-size-16);
      
      &-icon {
        width: calc($file-upload-icon-size * 0.8);
        height: calc($file-upload-icon-size * 0.8);
      }
      
      &-text {
        &-secondary {
          display: none;
        }
      }
    }
  }
  
  .sv-file-list__item {
    flex-wrap: wrap;
    
    &-preview {
      width: calc($file-upload-preview-size * 0.8);
      height: calc($file-upload-preview-size * 0.8);
    }
    
    &-details {
      width: calc(100% - #{$file-upload-preview-size * 0.8} - var(--sv-space-5));
    }
    
    &-actions {
      width: 100%;
      margin-left: calc($file-upload-preview-size * 0.8 + var(--sv-space-3));
      margin-top: var(--sv-space-2);
      justify-content: flex-end;
    }
  }
}

// RTL support
[dir="rtl"] {
  .sv-file-upload {
    &--compact {
      .sv-file-upload__label {
        &-icon {
          margin-right: 0;
          margin-left: var(--sv-space-2);
        }
        
        &-text {
          &-primary {
            margin-right: 0;
            margin-left: var(--sv-space-2);
          }
        }
      }
    }
  }
  
  .sv-file-list__item {
    &-preview {
      margin-right: 0;
      margin-left: var(--sv-space-3);
    }
    
    &-actions {
      margin-left: 0;
      margin-right: var(--sv-space-2);
    }
    
    &-details-info-size {
      margin-right: 0;
      margin-left: var(--sv-space-3);
    }
  }
  
  @include responsive.breakpoint-down(sm) {
    .sv-file-list__item {
      &-actions {
        margin-left: 0;
        margin-right: calc($file-upload-preview-size * 0.8 + var(--sv-space-3));
      }
    }
  }
}