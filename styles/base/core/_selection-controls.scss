/**
 * Selection Controls Base - Core Styles
 * Version: 2.0.0
 * Last Updated: June 29, 2024
 * 
 * This file establishes the foundational styles for all selection control components
 * in the SkillVo design system. It serves as the second level in our 
 * three-tier styling architecture:
 * 1. sv-ui-control-base - Base styles for all interactive controls
 * 2. sv-selection-control-base (this file) - Base styles for all selection controls
 * 3. Component-specific classes (e.g., sv-checkbox, sv-radio, sv-switch)
 *
 * Selection controls include checkboxes, radio buttons, switches, and other
 * components that allow users to select options from a set of choices.
 * 
 * For extension points and layer boundaries documentation, see:
 * styles/docs/base-control-extensions.md
 */

/* ==========================================================================
   TABLE OF CONTENTS:
   
   1. IMPORTS
   2. VARIABLES & CONFIGURATION
   3. BASE CLASS DEFINITION
   4. SIZE VARIATIONS
   5. SELECTION STATES
   6. ACCESSIBILITY ENHANCEMENTS
   ========================================================================== */

/* ==========================================================================
   1. IMPORTS
   ========================================================================== */
@use 'sass:map';
@use './../../abstracts' as *;
@use './../utils/mixins/state' as state;
@use './../utils/mixins/layout' as layout;
@use './../utils/mixins/typography' as typography;
@use './../utils/mixins/accessibility' as a11y;

/* ==========================================================================
   2. VARIABLES & CONFIGURATION
   ========================================================================== */

// Selection control properties
$selection-control-size: var(--sv-size-4);
$selection-control-border-width: 2px;
$selection-control-transition: all var(--sv-motion-duration-short) var(--sv-motion-ease-standard);

// Indicator properties (for checkmarks, dots, etc.)
$indicator-color: var(--sv-text-on-dark);
$indicator-size-ratio: 0.5; // Size of the indicator in relation to the control

/* ==========================================================================
   3. BASE CLASS DEFINITION
   ========================================================================== */

/**
 * The sv-selection-control-base class provides foundational styling for all
 * selection-based UI controls such as checkboxes, radio buttons, and switches.
 * 
 * This class extends sv-ui-control-base and adds selection-specific styling.
 */
.sv-selection-control-base {
  // Inherit all base UI control styles
  @extend .sv-ui-control-base !optional;
  
  // Basic layout and appearance
  position: relative;
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  
  // Reset some inherited properties that don't apply to selection controls
  background-color: transparent;
  padding: 0;
  border: none;
  
  // Apply spacing between stacked controls
  & + & {
    margin-top: var(--sv-space-3);
  }
  
  &.sv-selection-control-inline + &.sv-selection-control-inline {
    margin-top: 0;
    margin-left: var(--sv-space-4);
  }
  
  // Selection control input (checkbox, radio, etc.)
  &__input {
    // Hidden but accessible for screen readers
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
    margin: 0;
    
    // Focus styles handled via the control element
    &:focus-visible + .sv-selection-control-base__control {
      @include state.focus-visible-state;
    }
    
    // Checked state styling
    &:checked + .sv-selection-control-base__control {
      background-color: var(--sv-primary);
      border-color: var(--sv-primary);
      
      &::after {
        transform: translate(-50%, -50%) scale(1);
      }
    }
    
    // Special styling for indeterminate state (mainly for checkboxes)
    &:indeterminate + .sv-selection-control-base__control {
      background-color: var(--sv-primary-light);
      border-color: var(--sv-primary);
      
      &::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 50%;
        height: 2px;
        background-color: $indicator-color;
        transform: translate(-50%, -50%) scale(1);
      }
    }
    
    // Disabled state styling
    &:disabled + .sv-selection-control-base__control {
      @include state.disabled-state;
      
      & ~ .sv-selection-control-base__label {
        color: var(--sv-text-tertiary);
        cursor: not-allowed;
      }
    }
  }
  
  // The visual control element (the box/circle that gets checked)
  &__control {
    position: relative;
    display: inline-block;
    width: $selection-control-size;
    height: $selection-control-size;
    min-width: $selection-control-size;
    min-height: $selection-control-size;
    background-color: var(--sv-bg-surface);
    border: $selection-control-border-width solid var(--sv-border-medium);
    transition: $selection-control-transition;
    
    &::after {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      transition: transform var(--sv-motion-duration-short) var(--sv-motion-ease-standard);
    }
    
    // Apply hover state
    .sv-selection-control-base:hover &:not(.disabled) {
      border-color: var(--sv-border-dark);
      background-color: var(--sv-bg-element-hover);
    }
  }
  
  // The label text
  &__label {
    margin-left: var(--sv-space-3);
    font-size: var(--sv-font-size-base);
    color: var(--sv-text-primary);
    user-select: none;
  }
  
  // Container for additional help text or validation messages
  &__description {
    display: block;
    margin-top: var(--sv-space-1);
    margin-left: calc($selection-control-size + var(--sv-space-3));
    font-size: var(--sv-font-size-sm);
    color: var(--sv-text-secondary);
  }
  
  // Error state styling
  &.has-error,
  &.error,
  &[aria-invalid="true"] {
    .sv-selection-control-base__control {
      border-color: var(--sv-error);
    }
    
    .sv-selection-control-base__description {
      color: var(--sv-error);
    }
  }
  
  // Success state styling
  &.has-success,
  &.success,
  &[aria-invalid="false"] {
    .sv-selection-control-base__control {
      border-color: var(--sv-success);
    }
    
    .sv-selection-control-base__description {
      color: var(--sv-success);
    }
  }
  
  // Required indicator
  &.required .sv-selection-control-base__label::after {
    content: "*";
    color: var(--sv-error);
    margin-left: var(--sv-space-1);
  }
}

/* ==========================================================================
   4. SIZE VARIATIONS
   ========================================================================== */

.sv-selection-control-base {
  // Small size
  &.sv-size-sm {
    .sv-selection-control-base__control {
      width: calc($selection-control-size * 0.8);
      height: calc($selection-control-size * 0.8);
      min-width: calc($selection-control-size * 0.8);
      min-height: calc($selection-control-size * 0.8);
    }
    
    .sv-selection-control-base__label {
      font-size: var(--sv-font-size-sm);
    }
    
    .sv-selection-control-base__description {
      font-size: var(--sv-font-size-xs);
    }
  }
  
  // Large size
  &.sv-size-lg {
    .sv-selection-control-base__control {
      width: calc($selection-control-size * 1.2);
      height: calc($selection-control-size * 1.2);
      min-width: calc($selection-control-size * 1.2);
      min-height: calc($selection-control-size * 1.2);
      border-width: calc($selection-control-border-width * 1.2);
    }
    
    .sv-selection-control-base__label {
      font-size: var(--sv-font-size-lg);
    }
  }
}

/* ==========================================================================
   5. SELECTION STATES
   ========================================================================== */

// Checkbox-specific variant
.sv-selection-control-base.sv-checkbox {
  .sv-selection-control-base__control {
    border-radius: var(--sv-radius-sm);
    
    &::after {
      content: '';
      width: calc($selection-control-size * $indicator-size-ratio);
      height: calc($selection-control-size * $indicator-size-ratio * 0.5);
      border-left: 2px solid $indicator-color;
      border-bottom: 2px solid $indicator-color;
      transform: translate(-50%, -70%) rotate(-45deg) scale(0);
    }
  }
  
  .sv-selection-control-base__input:checked + .sv-selection-control-base__control::after {
    transform: translate(-50%, -70%) rotate(-45deg) scale(1);
  }
}

// Radio button-specific variant
.sv-selection-control-base.sv-radio {
  .sv-selection-control-base__control {
    border-radius: 50%;
    
    &::after {
      content: '';
      width: calc($selection-control-size * $indicator-size-ratio);
      height: calc($selection-control-size * $indicator-size-ratio);
      border-radius: 50%;
      background-color: $indicator-color;
    }
  }
}

// Switch-specific variant
.sv-selection-control-base.sv-switch {
  .sv-selection-control-base__control {
    width: calc($selection-control-size * 2);
    height: $selection-control-size;
    border-radius: calc($selection-control-size / 2);
    background-color: var(--sv-bg-element);
    
    &::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 25%;
      width: calc($selection-control-size * 0.8);
      height: calc($selection-control-size * 0.8);
      background-color: var(--sv-bg-surface);
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transform: translate(-50%, -50%);
      transition: left var(--sv-motion-duration-short) var(--sv-motion-ease-standard);
    }
  }
  
  .sv-selection-control-base__input:checked + .sv-selection-control-base__control::after {
    left: 75%;
    transform: translate(-50%, -50%);
  }
}

/* ==========================================================================
   6. ACCESSIBILITY ENHANCEMENTS
   ========================================================================== */

.sv-selection-control-base {
  // High contrast mode support
  @include a11y.high-contrast-mode {
    &__control {
      forced-color-adjust: none;
      border: 2px solid ButtonText;
    }
    
    &__input:checked + &__control {
      background-color: Highlight;
      border-color: Highlight;
    }
    
    &__input:disabled + &__control {
      border-color: GrayText;
      background-color: transparent;
    }
    
    &__input:disabled ~ &__label {
      color: GrayText;
    }
  }
  
  // Ensure proper focus handling for keyboard users
  &__input:focus-visible + &__control {
    @include a11y.focus-visible-enhanced;
  }
  
  // Support for reduced motion
  @include a11y.reduced-motion {
    &__control,
    &__control::after {
      transition: none;
    }
  }
}