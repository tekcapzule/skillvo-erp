/**
 * Navigation Controls Base - Core Styles
 * Version: 2.0.0
 * Last Updated: June 29, 2024
 * 
 * This file establishes the foundational styles for all navigation components
 * in the SkillVo design system. It serves as the second level in our 
 * three-tier styling architecture:
 * 1. sv-ui-control-base - Base styles for all interactive controls
 * 2. sv-nav-control-base (this file) - Base styles for all navigation components
 * 3. Component-specific classes (e.g., sv-nav-menu, sv-nav-tabs, sv-breadcrumbs)
 * 
 * For extension points and layer boundaries documentation, see:
 * styles/docs/base-control-extensions.md
 */

/* ==========================================================================
   TABLE OF CONTENTS:
   
   1. IMPORTS
   2. VARIABLES & CONFIGURATION
   3. BASE CLASS DEFINITION
   4. NAVIGATION LAYOUT VARIATIONS
   5. NAVIGATION STATES
   6. SIZE VARIATIONS
   7. RESPONSIVE NAVIGATION BEHAVIORS
   8. ACCESSIBILITY ENHANCEMENTS
   ========================================================================== */

/* ==========================================================================
   1. IMPORTS
   ========================================================================== */
@use 'sass:map';
@use './../../abstracts' as *;
@use './../core/_base-control' as *;
@use './../utils/mixins/state' as state;
@use './../utils/mixins/layout' as layout;
@use './../utils/mixins/typography' as typography;
@use './../utils/mixins/accessibility' as a11y;

/* ==========================================================================
   2. VARIABLES & CONFIGURATION
   ========================================================================== */

// Navigation structure variables
$nav-item-spacing: var(--sv-space-4);
$nav-item-spacing-compact: var(--sv-space-2);
$nav-indicator-height: 2px;
$nav-indicator-offset: -2px;

// Navigation-specific colors
$nav-active-color: var(--sv-primary);
$nav-hover-color: var(--sv-primary-hover);
$nav-default-color: var(--sv-text-primary);
$nav-disabled-color: var(--sv-text-tertiary);

// Navigation dividers
$nav-divider-color: var(--sv-border-light);
$nav-divider-size: 1px;

// Skip link configuration
$nav-skip-z-index: var(--sv-z-index-popup);
$nav-skip-padding: var(--sv-space-2) var(--sv-space-4);
$nav-skip-top: var(--sv-space-4);
$nav-skip-left: var(--sv-space-4);

/* ==========================================================================
   3. BASE CLASS DEFINITION
   ========================================================================== */

/**
 * The sv-nav-control-base class provides foundational styling for all
 * navigation-related UI controls such as menus, tabs, and breadcrumbs.
 * 
 * This class extends sv-ui-control-base and adds navigation-specific styling.
 */
.sv-nav-control-base {
  // Inherit all base UI control styles
  @extend .sv-ui-control-base;
  
  // Box model adjustments for navigation elements
  display: flex;
  flex-wrap: wrap;
  margin: 0;
  padding: 0;
  list-style: none; // Remove default list styling for nav elements
  
  // Typography defaults for navigation
  font-size: var(--sv-font-size-base);
  font-weight: var(--sv-font-weight-medium);
  line-height: var(--sv-line-height-normal);
  
  // Navigation-specific resets
  text-decoration: none;
  white-space: nowrap; // Prevent wrapping by default in navigation items
  
  // Ensure sufficient contrast for navigation elements
  color: $nav-default-color;
  
  // Default transition for navigation interactions
  transition: color var(--sv-motion-duration-short) var(--sv-motion-ease-standard),
              background-color var(--sv-motion-duration-short) var(--sv-motion-ease-standard),
              border-color var(--sv-motion-duration-short) var(--sv-motion-ease-standard);
  
  // Structure elements
  &__item {
    display: inline-flex;
    align-items: center;
    position: relative;
    padding: var(--sv-space-2) var(--sv-space-3);
    cursor: pointer;
    
    // Ensure adequate touch target for mobile
    min-height: var(--sv-touch-target-size);
    min-width: var(--sv-touch-target-size);
    
    &:hover:not(:disabled):not(.disabled) {
      color: $nav-hover-color;
      text-decoration: none;
    }
    
    // Active/Selected state
    &.active,
    &[aria-current="page"],
    &[aria-selected="true"] {
      color: $nav-active-color;
      font-weight: var(--sv-font-weight-semibold);
    }
    
    // Expanded state for dropdown navigation
    &[aria-expanded="true"] {
      color: $nav-active-color;
      background-color: var(--sv-bg-element-active);
    }
    
    // Disabled state
    &:disabled,
    &.disabled,
    &[aria-disabled="true"] {
      color: $nav-disabled-color;
      pointer-events: none;
      opacity: 0.65;
    }
  }
  
  &__icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-right: var(--sv-space-2);
  }
  
  &__text {
    flex: 1;
  }
  
  &__indicator {
    position: absolute;
    left: 0;
    bottom: $nav-indicator-offset;
    width: 100%;
    height: $nav-indicator-height;
    background-color: $nav-active-color;
    transform-origin: left center;
    transition: transform var(--sv-motion-duration-medium) var(--sv-motion-ease-standard);
    transform: scaleX(0);
    
    .active &,
    [aria-current="page"] &,
    [aria-selected="true"] & {
      transform: scaleX(1);
    }
  }
}

/* ==========================================================================
   4. NAVIGATION LAYOUT VARIATIONS
   ========================================================================== */

.sv-nav-control-base {
  // Horizontal navigation (default)
  &.sv-nav-horizontal {
    flex-direction: row;
    align-items: center;
    gap: $nav-item-spacing;
  }
  
  // Vertical navigation
  &.sv-nav-vertical {
    flex-direction: column;
    align-items: flex-start;
    gap: $nav-item-spacing-compact;
    
    .sv-nav-control-base__item {
      width: 100%;
    }
    
    .sv-nav-control-base__indicator {
      left: 0;
      top: 0;
      bottom: auto;
      width: $nav-indicator-height;
      height: 100%;
      transform: scaleY(0);
      
      .active &,
      [aria-current="page"] &,
      [aria-selected="true"] & {
        transform: scaleY(1);
      }
    }
  }
  
  // Navigation with dividers between items
  &.sv-nav-with-dividers {
    > .sv-nav-control-base__item + .sv-nav-control-base__item {
      position: relative;
      
      &::before {
        content: "";
        position: absolute;
        left: calc(-1 * $nav-item-spacing / 2);
        top: 50%;
        transform: translateY(-50%);
        height: 1em;
        width: $nav-divider-size;
        background-color: $nav-divider-color;
      }
    }
  }
  
  // Container with vertical dividers
  &.sv-nav-with-vertical-dividers {
    &.sv-nav-vertical > .sv-nav-control-base__item + .sv-nav-control-base__item {
      position: relative;
      
      &::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: $nav-divider-size;
        background-color: $nav-divider-color;
      }
    }
  }
  
  // Skip link for accessibility
  &.sv-nav-skip-link {
    position: absolute;
    top: -9999px;
    left: -9999px;
    z-index: $nav-skip-z-index;
    background-color: var(--sv-bg-surface);
    border: 1px solid var(--sv-border-medium);
    padding: $nav-skip-padding;
    
    &:focus {
      top: $nav-skip-top;
      left: $nav-skip-left;
    }
  }
}

/* ==========================================================================
   5. NAVIGATION STATES
   ========================================================================== */

.sv-nav-control-base {
  // Primary navigation style
  &.sv-nav-primary {
    .sv-nav-control-base__item {
      color: var(--sv-text-primary);
      
      &.active,
      &[aria-current="page"],
      &[aria-selected="true"] {
        color: $nav-active-color;
      }
    }
  }
  
  // Secondary navigation style
  &.sv-nav-secondary {
    .sv-nav-control-base__item {
      color: var(--sv-text-secondary);
      font-size: var(--sv-font-size-sm);
      
      &.active,
      &[aria-current="page"],
      &[aria-selected="true"] {
        color: $nav-active-color;
        font-weight: var(--sv-font-weight-medium);
      }
    }
  }
  
  // Subtle navigation style
  &.sv-nav-subtle {
    .sv-nav-control-base__item {
      color: var(--sv-text-tertiary);
      
      &:hover:not(:disabled):not(.disabled) {
        color: var(--sv-text-secondary);
      }
      
      &.active,
      &[aria-current="page"],
      &[aria-selected="true"] {
        color: var(--sv-text-primary);
        font-weight: var(--sv-font-weight-medium);
      }
    }
  }
  
  // Fill style for navigation items
  &.sv-nav-fill {
    .sv-nav-control-base__item {
      background-color: var(--sv-bg-element);
      
      &:hover:not(:disabled):not(.disabled) {
        background-color: var(--sv-bg-element-hover);
      }
      
      &.active,
      &[aria-current="page"],
      &[aria-selected="true"] {
        background-color: var(--sv-bg-element-active);
      }
    }
  }
}

/* ==========================================================================
   6. SIZE VARIATIONS
   ========================================================================== */

.sv-nav-control-base {
  // Small size
  &.sv-size-sm {
    font-size: var(--sv-font-size-sm);
    
    .sv-nav-control-base__item {
      padding: var(--sv-space-1) var(--sv-space-2);
    }
    
    &.sv-nav-horizontal {
      gap: var(--sv-space-2);
    }
    
    &.sv-nav-vertical {
      gap: var(--sv-space-1);
    }
  }
  
  // Default (medium) size inherits from base class
  
  // Large size
  &.sv-size-lg {
    font-size: var(--sv-font-size-lg);
    
    .sv-nav-control-base__item {
      padding: var(--sv-space-3) var(--sv-space-4);
    }
    
    &.sv-nav-horizontal {
      gap: var(--sv-space-5);
    }
    
    &.sv-nav-vertical {
      gap: var(--sv-space-3);
    }
  }
}

/* ==========================================================================
   7. RESPONSIVE NAVIGATION BEHAVIORS
   ========================================================================== */

// Different display modes based on screen size
.sv-nav-control-base {
  &.sv-nav-responsive {
    // Default styles at desktop sizes
    flex-direction: row;
    
    @media (max-width: var(--sv-breakpoint-md)) {
      // On smaller screens, change to vertical layout
      flex-direction: column;
      align-items: flex-start;
      
      .sv-nav-control-base__item {
        width: 100%;
        padding: var(--sv-space-2) var(--sv-space-3);
      }
      
      // Adjust dividers for responsive layout
      &.sv-nav-with-dividers > .sv-nav-control-base__item + .sv-nav-control-base__item::before {
        left: 0;
        top: 0;
        transform: none;
        width: 100%;
        height: $nav-divider-size;
      }
    }
  }
  
  // Hide/show based on screen size
  &.sv-nav-hide-mobile {
    @media (max-width: var(--sv-breakpoint-md)) {
      display: none;
    }
  }
  
  &.sv-nav-hide-desktop {
    @media (min-width: var(--sv-breakpoint-md)) {
      display: none;
    }
  }
}

/* ==========================================================================
   8. ACCESSIBILITY ENHANCEMENTS
   ========================================================================== */

.sv-nav-control-base {
  // High contrast mode support
  @include a11y.high-contrast-mode {
    .sv-nav-control-base__item {
      color: ButtonText;
      
      &.active,
      &[aria-current="page"],
      &[aria-selected="true"] {
        color: Highlight;
        border: 1px solid Highlight;
      }
      
      &:disabled,
      &.disabled,
      &[aria-disabled="true"] {
        color: GrayText;
      }
    }
    
    .sv-nav-control-base__indicator {
      background-color: Highlight;
    }
  }
  
  // Support for reduced motion
  @include a11y.reduced-motion {
    transition: none;
    
    .sv-nav-control-base__indicator {
      transition: none;
    }
  }
  
  // Improve keyboard focus visibility for navigation
  .sv-nav-control-base__item:focus-visible {
    @include state.focus-visible-state;
    text-decoration: none;
    position: relative;
    z-index: 1;
  }
  
  // Ensure proper ARIA states are visually represented
  [aria-hidden="true"] {
    display: none;
  }
  
  // Print styles for navigation
  @media print {
    .sv-nav-hide-print {
      display: none !important;
    }
  }
}